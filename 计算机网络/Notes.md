# 第一章 概述
因特网的核心部分由大量网络和连接这些网络的路由器组成。

在网络核心部分起特殊作用的是路由器(router)。 

路由器是实现分组交换(packet switching)的关键构件，其任务是转发收到的分组，这是网络核心部分最重要的功能。

路由器处理分组的过程是： 

把收到的分组先放入缓存（暂时存储）；

查找转发表，找出到某个目的地址应从哪个端口转发；

把分组送到适当的端口转发出去。

（文中😀为需要重点掌握的内容）

## 😀一些需要知道的定义
### 信息量
1KB=1024B=1024byte=8192bit。 

【单位名称】 Bit-比特;B-字节 ;KB-千字节 ;MB-兆字节 ;GB-吉字节 ;TB-太字节

请注意：在计算机界，K = 2^10 = 1024
M = 2^20, G = 2^30, T = 2^40。


### 速率 
速率即数据率(data rate)或比特率(bit rate)是计算机网络中最重要的一个性能指标。速率的单位是 b/s，或kb/s, Mb/s, Gb/s 等

速率往往是指额定速率或标称速率。

1B=8b,B是Byte，b是bit

bps=bit per second=b/s

### 带宽 
现在“带宽”是数字信道所能传送的“最高数据率”的同义语，单位是“比特每秒”，或 b/s (bit/s)。

常用的带宽单位是
千比每秒，即 kb/s （10^3 b/s）

兆比每秒，即 Mb/s（10^6 b/s）

吉比每秒，即 Gb/s（10^9 b/s）

太比每秒，即 Tb/s（10^12 b/s）

1B=8b 1B/s=8b/s(或1Bps=8bps) 1KB=1024B 1KB/s=1024B/s 1MB=1024KB 1MB/s=1024KB/s

### 吞吐量 
吞吐量(throughput)表示在单位时间内通过某个网络（或信道、接口）的数据量。

吞吐量受网络的带宽或网络的额定速率的限制。

### 时延(delay 或 latency) 
传输时延（发送时延 ）   

发送数据时，数据块从结点进入到传输媒体所需要的时间。
也就是从发送数据帧的第一个比特算起，到该帧的最后一个比特发送完毕所需的时间。
传播时延    

电磁波在信道中需要传播一定的距离而花费的时间。
信号传输速率（即发送速率）和信号在信道上的传播速率是完全不同的概念。

处理时延    

交换结点为存储转发而进行一些必要的处理所花费的时间。

排队时延    

结点缓存队列中分组排队所经历的时延。
排队时延的长短往往取决于网络中当时的通信量。

数据经历的总时延就是发送时延、传播时延、处理时延和排队时延之和：

### 时延带宽积 
链路的时延带宽积又称为以比特为单位的链路长度。

### 信道利用率 
信道利用率指出某信道有百分之几的时间是被利用的（有数据通过）。完全空闲的信道的利用率是零。

网络利用率则是全网络的信道利用率的加权平均值。

信道利用率并非越高越好。

### 分组交换
在发送端，先把较长的报文划分成较短的、固定长度的数据段。添加首部构成分组
每一个分组的首部都含有地址等控制信息。

分组交换网中的结点交换机根据收到的分组的首部中的地址信息，把分组转发到下一个结点交换机。
用这样的存储转发方式，最后分组就能到达最终目的地。
收到分组后剥去首部，接收端收到分组后剥去首部还原成报文。
最后还原成原来的报文

# 第二章 物理层
## 😀信道
单向通信（单工通信）——只能有一个方向的通信而没有反方向的交互。

双向交替通信（半双工通信）——通信的双方都可以发送信息，但不能双方同时发送(当然也就不能同时接收)。

双向同时通信（全双工通信）——通信的双方可以同时发送和接收信息。

几种最基本的调制方法 

调幅(AM)：载波的振幅随基带数字信号而变化。

调频(FM)：载波的频率随基带数字信号而变化。

调相(PM) ：载波的初始相位随基带数字信号而变化。

## 😀信道的极限容量
信噪比 S/N，S 为信道内所传信号的平均功率； N 为信道内部的高斯噪声功率。 

奈氏准则：无噪声时，信道的极限信息传输速率 C 可表达为 C = 2W log2V  b/s 

V是码元的离散电平数目，即共有几种码元，二进制取2。

香农：信道的极限信息传输速率 C 可表达为 C = W log2(1+S/N)  b/s 


## 😀信道复用技术
### 频分复用、时分复用和统计时分复用
频分复用 FDM(Frequency Division Multiplexing) 

用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。 

时分复用TDM(Time Division Multiplexing) 

时分复用则是将时间划分为一段段等长的时分复用帧（TDM 帧）。每一个时分复用的用户在每一个 TDM 帧中占用固定序号的时隙。 

统计时分复用 STDM(Statistic TDM) 

是对时分复用的一种改进，不固定每个用户在时分复用帧中的位置，只要有数据就集中起来组成统计时分复用帧然后发送。 


### 波分复用
波分复用 WDM(Wavelength Division Multiplexing) 

光的频分复用。由于光的频率很高，因此习惯上用波长而不是频率来表示所使用的光载波。

### 码分复用
码分复用 CDM(Code Division Multiplexing) 

常用的名词是码分多址 CDMA     (Code Division Multiple Access)。
各用户使用经过特殊挑选的不同码型，因此彼此不会造成干扰。
这种系统发送的信号有很强的抗干扰能力，其频谱类似于白噪声，不易被敌人发现。
每一个比特时间划分为 m 个短的间隔，称为码片(chip)。

具体内容 

1.为每个用户分配 m bit 的码片，并且所有的码片正交，对于任意两个码片 S 和 T 有

2.为了讨论方便，取 m=8，设码片 s 为 00011011。在拥有该码片的用户发送比特 1 时就发送该码片，发送比特 0 时就发送该码片的反码 11100100。

在计算时将 00011011 记作 (-1 -1 -1 +1 +1 -1 +1 +1)，可以得到(其中 S' 为 S 的反码。) * 3.利用上面的式子我们知道，当接收端使用码片  对接收到的数据进行内积运算时（再除以8），结果为 0 的是其它用户发送的数据，结果为 1 的是用户发送的比特 1，结果为 -1 的是用户发送的比特 0。 * 码分复用需要发送的数据量为原先的 m 倍。

两个向量a = [a1, a2,…, an]和b = [b1, b2,…, bn]的点积定义为a·b=a1b1+a2b2+……+anbn。


# 第三章 数据链路层
## 数据链路和帧
信道主要有以下两种类型： 
点对点信道。这种信道使用一对一的点对点通信方式。
广播信道。这种信道使用一对多的广播通信方式

## 数据链路层模型
链路(link)是一条无源的点到点的物理线路段，中间没有任何其他的交换结点。
数据链路层传送的是帧

## 三个基本问题
(1) 封装成帧 
将网络层传下来的分组添加首部和尾部，用于标记帧的开始和结束。 

(2) 透明传输 
透明表示一个实际存在的事物看起来好像不存在一样。
帧使用首部和尾部进行定界，如果帧的数据部分含有和首部尾部相同的内容，需要在数据部分出现首部尾部相同的内容前面插入转义字符。如果数据部分出现转义字符，那么就在转义字符前面再加个转义字符。在接收端进行处理之后可以还原出原始数据。这个过程透明传输的内容是转义字符，用户察觉不到转义字符的存在。 

(3) 差错控制 
 循环冗余检验 CRC 目前数据链路层广泛使用了循环冗余检验（CRC）来检查比特差错。 
 帧检验序列 FCS 在数据后面添加上的冗余码称为帧检验序列 FCS (Frame Check Sequence)。 
 
## 😀冗余码的计算
 
例子： 现在 k = 6, M = 101001。 设 n = 3, 除数 P = 1101， 被除数是 2^nM = 101001000。 模 2 运算的结果是：商 Q = 110101， 余数 R = 001。 把余数 R 作为冗余码添加在数据 M 的后面发送出去。发送的数据是：2^nM + R 即：101001001，共 (k + n) 位。

 概要: CRC 是一种常用的检错方法，而 FCS 是添加在数据后面的冗余码。 FCS 可以用 CRC 这种方法得出，但 CRC 并非用来获得 FCS 的唯一方法。 

## 点对点协议 PPP
点到点协议（Point to Point Protocol，PPP）是为在同等单元之间传输数据包这样的简单链路设计的链路层协议。 [1]  这种链路提供全双工操作，并按照顺序传递数据包。设计目的主要是用来通过拨号或专线方式建立点对点连接发送数据，使其成为各种主机、网桥和路由器之间简单连接的一种共通的解决方案。
过程： 当用户拨号接入 ISP 时，路由器的调制解调器对拨号做出确认，并建立一条物理连接。 PC 机向路由器发送一系列的 LCP 分组（封装成多个 PPP 帧）。 这些分组及其响应选择一些 PPP 参数，和进行网络层配置，NCP 给新接入的 PC机分配一个临时的 IP 地址，使 PC 机成为因特网上的一个主机。 通信完毕时，NCP 释放网络层连接，收回原来分配出去的 IP 地址。接着，LCP 释放数据链路层连接。最后释放的是物理层的连接。
互联网服务提供商（Internet Service Provider），简称ISP
链路控制协议，简称LCP（Link Control Protocol）
网络控制协议，NCP Network control protocol 

## 局域网的数据链路层
使用广播信道
主要特点是网络为一个单位所拥有，且地理范围和站点数目均有限。

网络接口板又称为通信适配器(adapter)或网络接口卡 NIC (Network Interface Card)，或“网卡”。 
网桥在转发帧之前必须执行 CSMA/CD 算法。
适配器的重要功能： 
进行串行/并行转换。
对数据进行缓存。
在计算机的操作系统安装设备驱动程序。
实现以太网协议。

## 😀CSMA/CD 协议
载波监听多点接入 / 碰撞检测
(Carrier Sense Multiple Access/collision detection）
工作流程
先听后说，边听边说。一旦冲突，立即停说。等待时机，然后再说。
多点接入 ：说明这是总线型网络，许多主机以多点的方式连接到总线上。
载波监听 ：每个主机都必须不停地监听信道。在发送前，如果监听到信道正在使用，就必须等待。
碰撞检测 ：在发送中，如果监听到信道已有其它主机正在发送数据，就表示发生了碰撞。虽然每个主机在发送数据之前都已经监听到信道为空闲，但是由于电磁波的传播时延的存在，还是有可能会发生碰撞。
记端到端的传播时延为 τ，最先发送的站点最多经过 2τ 就可以知道是否发生了碰撞，称 2τ 为 争用期 。只有经过争用期之后还没有检测到碰撞，才能肯定这次发送不会发生碰撞。
二进制指数退避算法
规则如下：
对每个帧，当第一次发生冲突时，设置参数L=2。退避重发时间在0或者1个时隙中随机抽取一个再重发。
当帧再次冲突时，退避时间参数的最大值加倍，当冲突n次，由此时的退避时间参数的最大值为最初L值的2^n倍。退避重发时间在0～（2n-1）个时隙中随机抽取一个再重发。可以设置一个最大重传次数，超过此值，不再重发，并报告出错。一般是第10次冲突之后，随机数的时间间隙数就固定在1023上，不再增加了。16次冲突后，就会放弃努力，并且给发送数据的站点返回一个错误报告。

## MAC地址
物理地址，硬件地址
每一个设备一个MAC地址
MAC地址48位（6字节），十六进制表示，例如30-84-9E-ED85-CA

## 以太网协议
以太网是一种广泛运用的局域网技术，可以完成相邻数据帧的传输
交换机具有自学习能力，学习的是交换表的内容，交换表中存储着 MAC 地址到接口的映射。 正是由于这种自学习能力，因此交换机是一种即插即用设备，不需要网络管理员手动配置交换表内容。 
网桥只适合于用户数不太多(不超过几百个)和通信量不太大的局域网，否则有时还会因传播过多的广播信息而产生网络拥塞。这就是所谓的广播风暴。


# 第四章 网络层
## 😀IP协议
实际网络是很复杂的，因此提出虚拟互联网络的概念——这里面使用ip协议屏蔽网络之间的差异，无需关注网络细节。直接实现：计算机A->虚拟互联网络->计算机B。
每一个设备都有它唯一的ip地址。
ip地址长度为32位，分成4个8位，采用点分十进制。0-255.0-255.0-255.0-255
MAC与IP的区别：
MAC恒定不变；ip可变，随着网络环境变化。

版本 : 有 4（IPv4）和 6（IPv6）两个值；
首部长度 : 占 4 位，因此最大值为 15。单位：32 位字的长度，也就是 4 字节。因此ip首部最大长度为60字节。
因为固定部分长度为 20 字节，因此该值最小为 5。如果可选字段的长度不是 4 字节的整数倍，就用尾部的填充部分来填充。
标识 : 在数据报长度过长从而发生分片的情况下，相同数据报的不同分片具有相同的标识符。
片偏移 : 和标识符一起，用于发生分片的情况。片偏移的单位为 8 字节。 如果ip数据报文比MTU长，那么就会进行分片。
总长度 : 16位，最大数值65535，表示ip数据报总长度。
生存时间 ：每经过一个设备TTL减一，当 TTL 为 0 时就丢弃数据报。避免数据在网络中无限度传输消耗带宽。
协议 ：指出携带的数据应该上交给哪个协议进行处理，例如 ICMP、TCP、UDP 等。
首部检验和 ：16位，因为数据报每经过一个路由器，都要重新计算检验和，因此检验和不包含数据部分可以减少计算的工作量。

路由表：第一列是目的IP地址，第二列是下一跳的IP地址。计算机和路由器都有路由表。

发出目的地为的IP数据报，查询路由表寻找下一跳；
发现下一跳，把数据发给下一跳；
每一跳的源MAC地址和目的MAC地址都不发生变化；但原IP地址和目的IP地址一直在发生变化。

## ARP协议与RARP协议
ARP：地址解析协议，目的是把网络层IP32位地址转化为数据链路层MAC48位地址。
ARP缓存表，第一列为IP，第二列为MAC。
但缓存表中没有对应的MAC时，本机将会广播数据包，问谁是这个IP地址，收到回应之后再录入缓存表。

RARP为逆地址解析协议

## 😀IP地址与子网划分
分类的IP地址
每一类地址都由网络号(net-id)和主机号(host-id)构成
主机号全0表示当前网络段，不可分配为特定主机，主机号全1表示广播地址（向当前网络段所有主机发送消息）
例如如果发送数据到1.255.255.255，则该数据会发送给当前网络所有主机
网络段全0表示特殊网络，A网络段全1表示回环地址

## NAT技术
网络地址转换network address translation。用于多个主机通过一个公有ip访问互联网的私有网络中。是一种端口转换技术，发生在本地的路由器。  
增加了网络通信的复杂度但减缓了IP地址的损耗。
内网ip地址是公司或者机构内部使用的，外网ip地址是全球唯一的。一个公司在内部使用内网地址，外部使用全球唯一的外网ip。
如果内网一个设备请求外网的服务，外部怎么知道是哪一个设备在请求呢？

端口号：指某个特定设备的1特定进程。

## 😀ICMP协议
ICMP（Internet Control Message Protocol）网际控制报文协议。主要用于辅助ip协议传输数据，用于报告错误信息或者异常情况。

封装在ip数据报中传输

ICMP的应用：
        PING： 源主机向目标主机发送ICMP的回送请求报文（封装在IP数据报中），目标主机若接收到该报文则返回回送回答报文
        Traceroute路由探测：  ip数据报文每经过一个设备TTL就减一，到0时网络设备丢弃该报文并发送ICMP终点不可达报文。利用这一点来探测数据报文在网络中走过的路。发送TTL为1的，找到第一跳，源主机收到ICMP不可达报文后再发送TTL为2的，找到第二跳，以此类推找到ip数据走过的路径。

## 😀内部网关RIP协议
概述：是一种分布式，基于距离的路由选择协议。每隔30s交换一次信息。
距离：直连网络距离为1，每过一个非直连网络距离加1，距离也称为跳数，每经过一个路由器跳数就加1，距离实际上指最短距离
RIP允许一个路径最多包含15个路由器，也就是距离最大值为16，故RIP适合小型互联网使用
 
距离向量算法：
  (1)路由器收到地址为X的相邻路由器的一个RIP报文，修改报文中所有项目，把下一跳地址改为X，把距离字段值都+1
  (2)对修改后的RIP报文中的每个项目重复以下步骤
    若项目中目的地址不在路由表中，则加入路由表；
    若下一跳给出的路由器地址与RIP报文传来地址（即X）相同，则用收到的项目替换原路由表中的项目
    若收到项目中的距离小于路由表中的距离，进行更新
  (3)若超过3分钟未收到相邻路由信息，则将其标记为不可达，即把距离置为16
  
RIP协议特点：
        好消息传播快，坏消息传播慢，网络出故障的传播时间需要较长时间
        优点：实现简单，开销较小；
        缺点：限制了网络的规模，出故障时传播时间较长。
   盲目相信隔壁路由器，并且视野不够。


## 😀OSPF协议
 Open Shortest Path First 开放最短路径优先。迪杰斯特拉算法。
主要特征：使用分布式的链路状态协议，而不像RIP使用距离向量协议
OSPF的要点：
    (1)向本自治系统中所有路由器发送信息（每个相邻路由又再将此信息发给所有相邻路由）。构建链路状态数据库。
    (2)发送信息就是与本路由器相邻的所有路由器的链路状态，说明与哪些路由相邻，以及该链路的"度量"；而不是发生路由表。
    (3)只有当链路状态发生变化时，才更新。
           
度量：费用、距离、时延、带宽

OSPF报文的5种分组类型：
        类型1：问候分组；
        类型2：数据库描述分组；
        类型3：链路状态请求分组；
        类型4：链路状态更新分组，用泛洪法对全网更新链路状态；
        类型5：链路状态确认分组
指定路由器法：指定一个代表路由器，将信息都传送给指定的路由，再由其向其他路由器转发，减小网络上的通信量

## 😀外部网关BGP协议
(External Gateway Protocol)  两个公司/机构内部采用的协议可能不一样比如一个用rip，一个用ospf。所以为了解决这个冲突有了bgp协议。
若源站和目的站处在不同的自治系统中，当数据报传到一个自治系统的边界时，就需要使用一种协议将路由选择信息传递到另一个自治系统中。每个 AS 都必须配置 BGP 发言人，通过在两个相邻 BGP 发言人之间建立 TCP 连接来交换路由信息。
